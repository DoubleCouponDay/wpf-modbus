<?xml version='1.0' encoding='utf-8'?>
<project xmlns="http://www.plcopen.org/xml/tc6_0201" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:ns1="http://www.plcopen.org/xml/tc6_0201">
  <fileHeader companyName="Unknown" productName="motor_driver" productVersion="1" creationDateTime="2024-07-05T11:44:58"/>
  <contentHeader name="motor_driver" modificationDateTime="2024-07-07T20:39:42">
    <coordinateInfo>
      <fbd>
        <scaling x="10" y="10"/>
      </fbd>
      <ld>
        <scaling x="10" y="10"/>
      </ld>
      <sfc>
        <scaling x="10" y="10"/>
      </sfc>
    </coordinateInfo>
  </contentHeader>
  <types>
    <dataTypes/>
    <pous>
      <pou name="motor_driver" pouType="program">
        <interface>
          <localVars>
            <variable name="led" address="%QX0.3">
              <type>
                <BOOL/>
              </type>
            </variable>
          </localVars>
          <localVars>
            <variable name="output_on_timer">
              <type>
                <derived name="TON"/>
              </type>
            </variable>
            <variable name="output_off_timer">
              <type>
                <derived name="TOF"/>
              </type>
            </variable>
            <variable name="input_angle">
              <type>
                <INT/>
              </type>
              <initialValue>
                <simpleValue value="90"/>
              </initialValue>
            </variable>
            <variable name="real_angle">
              <type>
                <REAL/>
              </type>
              <initialValue>
                <simpleValue value="90.0"/>
              </initialValue>
            </variable>
            <variable name="duty_cycle">
              <type>
                <UINT/>
              </type>
              <initialValue>
                <simpleValue value="50"/>
              </initialValue>
            </variable>
            <variable name="on_PT">
              <type>
                <TIME/>
              </type>
              <initialValue>
                <simpleValue value="T#1ms"/>
              </initialValue>
            </variable>
            <variable name="off_PT">
              <type>
                <TIME/>
              </type>
              <initialValue>
                <simpleValue value="T#1ms"/>
              </initialValue>
            </variable>
          </localVars>
          <localVars>
            <variable name="output_pin" address="%QW1">
              <type>
                <UINT/>
              </type>
              <initialValue>
                <simpleValue value="65535"/>
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[(* validate the servo angle *)
IF(input_angle < 0) THEN
  input_angle := 0;

ELSIF(input_angle > 180) THEN
  input_angle := 180;

END_IF;

(* control the servo *)
real_angle := INT_TO_REAL(input_angle);
duty_cycle := REAL_TO_UINT(100.0 / 180.0 * real_angle);

on_PT := GET_ON_TIME(duty_cycle);

output_on_timer(IN := NOT(output_off_timer.Q), PT := on_PT);
output_off_timer(IN := output_on_timer.Q, PT := off_PT);

IF output_on_timer.Q THEN
  output_pin := 65535;
  
ELSE
  output_pin := 0;

END_IF;

(* Blink the builtin LED *)
led := output_on_timer.Q;
]]></xhtml:p>
          </ST>
        </body>
      </pou>
      <pou name="GET_ON_TIME" pouType="function">
        <interface>
          <returnType>
            <TIME/>
          </returnType>
          <inputVars>
            <variable name="duty_cycle">
              <type>
                <UINT/>
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="local_time">
              <type>
                <TIME/>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[IF (duty_cycle = 0) THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 1 THEN
  GET_ON_TIME := T#0.01ms;
	RETURN;
  
ELSIF duty_cycle = 2 THEN
  GET_ON_TIME := T#0.02ms;
  RETURN;
  
ELSIF duty_cycle = 3 THEN
  GET_ON_TIME := T#0.03ms;
  RETURN;
  
ELSIF duty_cycle = 4 THEN
  GET_ON_TIME := T#0.04ms;
  RETURN;
  
ELSIF duty_cycle = 5 THEN
  GET_ON_TIME := T#0.05ms;
  RETURN;
  
ELSIF duty_cycle = 6 THEN
  GET_ON_TIME := T#0.06ms;
  RETURN;

ELSIF duty_cycle = 7 THEN
  GET_ON_TIME := T#0.07ms;
  RETURN;
  
ELSIF duty_cycle = 8 THEN
  GET_ON_TIME := T#0.08ms;
  RETURN;
    
ELSIF duty_cycle = 9 THEN
  GET_ON_TIME := T#0.09ms;
  RETURN;
  
ELSIF duty_cycle = 10 THEN
  GET_ON_TIME := T#0.1ms;
  RETURN;

ELSIF duty_cycle = 11 THEN
  GET_ON_TIME := T#0.11ms;
  RETURN;

ELSIF duty_cycle = 12 THEN
  GET_ON_TIME := T#0.12ms;
  RETURN;

ELSIF duty_cycle = 13 THEN
  GET_ON_TIME := T#0.13ms;
  RETURN;

ELSIF duty_cycle = 14 THEN
  GET_ON_TIME := T#0.14ms;
  RETURN;

ELSIF duty_cycle = 15 THEN
  GET_ON_TIME := T#0.15ms;
  RETURN;

ELSIF duty_cycle = 16 THEN
  GET_ON_TIME := T#0.16ms;
  RETURN;

ELSIF duty_cycle = 17 THEN
  GET_ON_TIME := T#0.17ms;
  RETURN;

ELSIF duty_cycle = 18 THEN
  GET_ON_TIME := T#0.18ms;
  RETURN;

ELSIF duty_cycle = 19 THEN
  GET_ON_TIME := T#0.19ms;
  RETURN;

ELSIF duty_cycle = 20 THEN
  GET_ON_TIME := T#0.2ms;
  RETURN;

ELSIF duty_cycle = 21 THEN
  GET_ON_TIME := T#0.21ms;
  RETURN;

ELSIF duty_cycle = 22 THEN
  GET_ON_TIME := T#0.22ms;
  RETURN;

ELSIF duty_cycle = 23 THEN
  GET_ON_TIME := T#0.23ms;
  RETURN;

ELSIF duty_cycle = 24 THEN
  GET_ON_TIME := T#0.24ms;
  RETURN;

ELSIF duty_cycle = 25 THEN
  GET_ON_TIME := T#0.25ms;
  RETURN;

ELSIF duty_cycle = 26 THEN
  GET_ON_TIME := T#0.26ms;
  RETURN;

ELSIF duty_cycle = 27 THEN
  GET_ON_TIME := T#0.27ms;
  RETURN;

ELSIF duty_cycle = 28 THEN
  GET_ON_TIME := T#0.28ms;
  RETURN;

ELSIF duty_cycle = 29 THEN
  GET_ON_TIME := T#0.29ms;
  RETURN;

ELSIF duty_cycle = 30 THEN
  GET_ON_TIME := T#0.3ms;
  RETURN;

ELSIF duty_cycle = 31 THEN
  GET_ON_TIME := T#0.31ms;
  RETURN;

ELSIF duty_cycle = 32 THEN
  GET_ON_TIME := T#0.32ms;
  RETURN;

ELSIF duty_cycle = 33 THEN
  GET_ON_TIME := T#0.33ms;
  RETURN;

ELSIF duty_cycle = 34 THEN
  GET_ON_TIME := T#0.34ms;
  RETURN;

ELSIF duty_cycle = 35 THEN
  GET_ON_TIME := T#0.35ms;
  RETURN;

ELSIF duty_cycle = 36 THEN
  GET_ON_TIME := T#0.36ms;
  RETURN;

ELSIF duty_cycle = 37 THEN
  GET_ON_TIME := T#0.37ms;
  RETURN;

ELSIF duty_cycle = 38 THEN
  GET_ON_TIME := T#0.38ms;
  RETURN;

ELSIF duty_cycle = 39 THEN
  GET_ON_TIME := T#0.39ms;
  RETURN;

ELSIF duty_cycle = 40 THEN
  GET_ON_TIME := T#0.4ms;
  RETURN;

ELSIF duty_cycle = 41 THEN
  GET_ON_TIME := T#0.41ms;
  RETURN;

ELSIF duty_cycle = 42 THEN
  GET_ON_TIME := T#0.42ms;
  RETURN;

ELSIF duty_cycle = 43 THEN
  GET_ON_TIME := T#0.43ms;
  RETURN;

ELSIF duty_cycle = 44 THEN
  GET_ON_TIME := T#0.44ms;
  RETURN;

ELSIF duty_cycle = 45 THEN
  GET_ON_TIME := T#0.45ms;
  RETURN;

ELSIF duty_cycle = 46 THEN
  GET_ON_TIME := T#0.46ms;
  RETURN;

ELSIF duty_cycle = 47 THEN
  GET_ON_TIME := T#0.47ms;
  RETURN;

ELSIF duty_cycle = 48 THEN
  GET_ON_TIME := T#0.48ms;
  RETURN;

ELSIF duty_cycle = 49 THEN
  GET_ON_TIME := T#0.49ms;
  RETURN;

ELSIF duty_cycle = 50 THEN
  GET_ON_TIME := T#0.5ms;
  RETURN;

ELSIF duty_cycle = 51 THEN
  GET_ON_TIME := T#0.51ms;
  RETURN;

ELSIF duty_cycle = 52 THEN
  GET_ON_TIME := T#0.52ms;
  RETURN;

ELSIF duty_cycle = 53 THEN
  GET_ON_TIME := T#0.53ms;
  RETURN;

ELSIF duty_cycle = 54 THEN
  GET_ON_TIME := T#0.54ms;
  RETURN;

ELSIF duty_cycle = 55 THEN
  GET_ON_TIME := T#0.55ms;
  RETURN;

ELSIF duty_cycle = 56 THEN
  GET_ON_TIME := T#0.56ms;
  RETURN;

ELSIF duty_cycle = 57 THEN
  GET_ON_TIME := T#0.57ms;
  RETURN;
  
ELSIF duty_cycle = 58 THEN
  GET_ON_TIME := T#0.58ms;
  RETURN;

ELSIF duty_cycle = 59 THEN
  GET_ON_TIME := T#0.59ms;
  RETURN;

ELSIF duty_cycle = 60 THEN
  GET_ON_TIME := T#0.6ms;
  RETURN;

ELSIF duty_cycle = 61 THEN
  GET_ON_TIME := T#0.61ms;
  RETURN;

ELSIF duty_cycle = 62 THEN
  GET_ON_TIME := T#0.62ms;
  RETURN;

ELSIF duty_cycle = 63 THEN
  GET_ON_TIME := T#0.63ms;
  RETURN;

ELSIF duty_cycle = 64 THEN
  GET_ON_TIME := T#0.64ms;
  RETURN;

ELSIF duty_cycle = 65 THEN
  GET_ON_TIME := T#0.65ms;
  RETURN;

ELSIF duty_cycle = 66 THEN
  GET_ON_TIME := T#0.66ms;
  RETURN;

ELSIF duty_cycle = 67 THEN
  GET_ON_TIME := T#0.67ms;
  RETURN;

ELSIF duty_cycle = 68 THEN
  GET_ON_TIME := T#0.68ms;
  RETURN;

ELSIF duty_cycle = 69 THEN
  GET_ON_TIME := T#0.69ms;
  RETURN;

ELSIF duty_cycle = 70 THEN
  GET_ON_TIME := T#0.7ms;
  RETURN;

ELSIF duty_cycle = 71 THEN
  GET_ON_TIME := T#0.71ms;
  RETURN;

ELSIF duty_cycle = 72 THEN
  GET_ON_TIME := T#0.72ms;
  RETURN;

ELSIF duty_cycle = 73 THEN
  GET_ON_TIME := T#0.73ms;
  RETURN;

ELSIF duty_cycle = 74 THEN
  GET_ON_TIME := T#0.74ms;
  RETURN;

ELSIF duty_cycle = 75 THEN
  GET_ON_TIME := T#0.75ms;
  RETURN;

ELSIF duty_cycle = 76 THEN
  GET_ON_TIME := T#0.76ms;
  RETURN;

ELSIF duty_cycle = 77 THEN
  GET_ON_TIME := T#0.77ms;
  RETURN;

ELSIF duty_cycle = 78 THEN
  GET_ON_TIME := T#0.78ms;
  RETURN;

ELSIF duty_cycle = 79 THEN
  GET_ON_TIME := T#0.79ms;
  RETURN;

ELSIF duty_cycle = 80 THEN
  GET_ON_TIME := T#0.8ms;
  RETURN;

ELSIF duty_cycle = 81 THEN
  GET_ON_TIME := T#0.81ms;
  RETURN;

ELSIF duty_cycle = 82 THEN
  GET_ON_TIME := T#0.82ms;
  RETURN;

ELSIF duty_cycle = 83 THEN
  GET_ON_TIME := T#0.83ms;
  RETURN;

ELSIF duty_cycle = 84 THEN
  GET_ON_TIME := T#0.84ms;
  RETURN;

ELSIF duty_cycle = 85 THEN
  GET_ON_TIME := T#0.85ms;
  RETURN;

ELSIF duty_cycle = 86 THEN
  GET_ON_TIME := T#0.86ms;
  RETURN;

ELSIF duty_cycle = 87 THEN
  GET_ON_TIME := T#0.87ms;
  RETURN;
  
ELSIF duty_cycle = 88 THEN
  GET_ON_TIME := T#0.88ms;
  RETURN;

ELSIF duty_cycle = 89 THEN
  GET_ON_TIME := T#0.89ms;
  RETURN;

ELSIF duty_cycle = 90 THEN
  GET_ON_TIME := T#0.9ms;
  RETURN;
  
ELSIF duty_cycle = 91 THEN
  GET_ON_TIME := T#0.91ms;
  RETURN;

ELSIF duty_cycle = 92 THEN
  GET_ON_TIME := T#0.92ms;
  RETURN;

ELSIF duty_cycle = 93 THEN
  GET_ON_TIME := T#0.93ms;
  RETURN;

ELSIF duty_cycle = 94 THEN
  GET_ON_TIME := T#0.94ms;
  RETURN;

ELSIF duty_cycle = 95 THEN
  GET_ON_TIME := T#0.95ms;
  RETURN;

ELSIF duty_cycle = 96 THEN
  GET_ON_TIME := T#0.96ms;
  RETURN;

ELSIF duty_cycle = 97 THEN
  GET_ON_TIME := T#0.97ms;
  RETURN;

ELSIF duty_cycle = 98 THEN
  GET_ON_TIME := T#0.98ms;
  RETURN;

ELSIF duty_cycle = 99 THEN
  GET_ON_TIME := T#0.9ms;
  RETURN;

ELSIF duty_cycle = 100 THEN
  GET_ON_TIME := T#1ms;
  RETURN;

END_IF;
]]></xhtml:p>
          </ST>
        </body>
      </pou>
    </pous>
  </types>
  <instances>
    <configurations>
      <configuration name="Config0">
        <resource name="Res0">
          <task name="task0" priority="0" interval="T#1ms">
            <pouInstance name="instance0" typeName="motor_driver"/>
          </task>
        </resource>
      </configuration>
    </configurations>
  </instances>
</project>
