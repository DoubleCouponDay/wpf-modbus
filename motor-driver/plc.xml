<?xml version='1.0' encoding='utf-8'?>
<project xmlns="http://www.plcopen.org/xml/tc6_0201" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:ns1="http://www.plcopen.org/xml/tc6_0201">
  <fileHeader companyName="Unknown" productName="motor_driver" productVersion="1" creationDateTime="2024-07-05T11:44:58"/>
  <contentHeader name="motor_driver" modificationDateTime="2024-07-07T20:10:20">
    <coordinateInfo>
      <fbd>
        <scaling x="10" y="10"/>
      </fbd>
      <ld>
        <scaling x="10" y="10"/>
      </ld>
      <sfc>
        <scaling x="10" y="10"/>
      </sfc>
    </coordinateInfo>
  </contentHeader>
  <types>
    <dataTypes/>
    <pous>
      <pou name="motor_driver" pouType="program">
        <interface>
          <localVars>
            <variable name="led" address="%QX0.3">
              <type>
                <BOOL/>
              </type>
            </variable>
          </localVars>
          <localVars>
            <variable name="led_on_timer">
              <type>
                <derived name="TON"/>
              </type>
            </variable>
            <variable name="led_off_timer">
              <type>
                <derived name="TOF"/>
              </type>
            </variable>
            <variable name="output_on_timer">
              <type>
                <derived name="TON"/>
              </type>
            </variable>
            <variable name="output_off_timer">
              <type>
                <derived name="TOF"/>
              </type>
            </variable>
            <variable name="input_angle">
              <type>
                <INT/>
              </type>
              <initialValue>
                <simpleValue value="90"/>
              </initialValue>
            </variable>
            <variable name="real_angle">
              <type>
                <REAL/>
              </type>
              <initialValue>
                <simpleValue value="90.0"/>
              </initialValue>
            </variable>
            <variable name="duty_cycle">
              <type>
                <INT/>
              </type>
              <initialValue>
                <simpleValue value="50"/>
              </initialValue>
            </variable>
            <variable name="on_PT">
              <type>
                <TIME/>
              </type>
              <initialValue>
                <simpleValue value="T#10ms"/>
              </initialValue>
            </variable>
            <variable name="off_PT">
              <type>
                <TIME/>
              </type>
              <initialValue>
                <simpleValue value="T#10ms"/>
              </initialValue>
            </variable>
          </localVars>
          <localVars>
            <variable name="output_pin" address="%QW1">
              <type>
                <UINT/>
              </type>
              <initialValue>
                <simpleValue value="65535"/>
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[(* validate the servo angle *)
IF(input_angle < 0) THEN
  input_angle := 0;

ELSIF(input_angle > 180) THEN
  input_angle := 180;

END_IF;

(* control the servo *)
real_angle := INT_TO_REAL(input_angle);
duty_cycle := REAL_TO_UINT(100.0 / 180.0 * real_angle);

on_PT := GET_ON_TIME(duty_cycle);

output_on_timer(IN := NOT(output_off_timer.Q), PT := on_PT);
output_off_timer(IN := output_on_timer.Q, PT := off_PT);

IF output_on_timer.Q THEN
  output_pin := 65535;
  
ELSE
  output_pin := 0;

END_IF;

(* Blink the builtin LED *)
led := output_on_timer.Q;
]]></xhtml:p>
          </ST>
        </body>
      </pou>
      <pou name="GET_ON_TIME" pouType="function">
        <interface>
          <returnType>
            <TIME/>
          </returnType>
          <inputVars>
            <variable name="duty_cycle">
              <type>
                <UINT/>
              </type>
            </variable>
          </inputVars>
          <localVars>
            <variable name="local_time">
              <type>
                <TIME/>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[IF (duty_cycle = 0) THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 1 THEN
  GET_ON_TIME := T#2.5ms;
	RETURN;
  
ELSIF duty_cycle = 2 THEN
  GET_ON_TIME := T#4ms;
  RETURN;
  
ELSIF duty_cycle = 3 THEN
  GET_ON_TIME := T#6ms;
  RETURN;
  
ELSIF duty_cycle = 4 THEN
  GET_ON_TIME := T#8ms;
  RETURN;
  
ELSIF duty_cycle = 5 THEN
  GET_ON_TIME := T#10ms;
  RETURN;
  
ELSIF duty_cycle = 6 THEN
  GET_ON_TIME := T#12ms;
  RETURN;

ELSIF duty_cycle = 7 THEN
  GET_ON_TIME := T#14ms;
  RETURN;
  
ELSIF duty_cycle = 8 THEN
  GET_ON_TIME := T#16ms;
  RETURN;
    
ELSIF duty_cycle = 9 THEN
  GET_ON_TIME := T#18ms;
  RETURN;
  
ELSIF duty_cycle = 10 THEN
  GET_ON_TIME := T#20ms;
  RETURN;

ELSIF duty_cycle = 11 THEN
  GET_ON_TIME := T#22ms;
  RETURN;

ELSIF duty_cycle = 12 THEN
  GET_ON_TIME := T#24ms;
  RETURN;

ELSIF duty_cycle = 13 THEN
  GET_ON_TIME := T#26ms;
  RETURN;

ELSIF duty_cycle = 14 THEN
  GET_ON_TIME := T#28ms;
  RETURN;

ELSIF duty_cycle = 15 THEN
  GET_ON_TIME := T#30ms;
  RETURN;

ELSIF duty_cycle = 16 THEN
  GET_ON_TIME := T#32ms;
  RETURN;

ELSIF duty_cycle = 17 THEN
  GET_ON_TIME := T#34ms;
  RETURN;

ELSIF duty_cycle = 18 THEN
  GET_ON_TIME := T#36ms;
  RETURN;

ELSIF duty_cycle = 19 THEN
  GET_ON_TIME := T#38ms;
  RETURN;

ELSIF duty_cycle = 20 THEN
  GET_ON_TIME := T#40ms;
  RETURN;

ELSIF duty_cycle = 21 THEN
  GET_ON_TIME := T#42ms;
  RETURN;

ELSIF duty_cycle = 22 THEN
  GET_ON_TIME := T#44ms;
  RETURN;

ELSIF duty_cycle = 23 THEN
  GET_ON_TIME := T#46ms;
  RETURN;

ELSIF duty_cycle = 24 THEN
  GET_ON_TIME := T#48ms;
  RETURN;

ELSIF duty_cycle = 25 THEN
  GET_ON_TIME := T#50ms;
  RETURN;

ELSIF duty_cycle = 26 THEN
  GET_ON_TIME := T#52ms;
  RETURN;

ELSIF duty_cycle = 27 THEN
  GET_ON_TIME := T#54ms;
  RETURN;

ELSIF duty_cycle = 28 THEN
  GET_ON_TIME := T#56ms;
  RETURN;

ELSIF duty_cycle = 29 THEN
  GET_ON_TIME := T#58ms;
  RETURN;

ELSIF duty_cycle = 30 THEN
  GET_ON_TIME := T#60ms;
  RETURN;

ELSIF duty_cycle = 31 THEN
  GET_ON_TIME := T#62ms;
  RETURN;

ELSIF duty_cycle = 32 THEN
  GET_ON_TIME := T#64ms;
  RETURN;

ELSIF duty_cycle = 33 THEN
  GET_ON_TIME := T#66ms;
  RETURN;

ELSIF duty_cycle = 34 THEN
  GET_ON_TIME := T#68ms;
  RETURN;

ELSIF duty_cycle = 35 THEN
  GET_ON_TIME := T#70ms;
  RETURN;

ELSIF duty_cycle = 36 THEN
  GET_ON_TIME := T#72ms;
  RETURN;

ELSIF duty_cycle = 37 THEN
  GET_ON_TIME := T#74ms;
  RETURN;

ELSIF duty_cycle = 38 THEN
  GET_ON_TIME := T#76ms;
  RETURN;

ELSIF duty_cycle = 39 THEN
  GET_ON_TIME := T#78ms;
  RETURN;

ELSIF duty_cycle = 40 THEN
  GET_ON_TIME := T#80ms;
  RETURN;

ELSIF duty_cycle = 41 THEN
  GET_ON_TIME := T#82ms;
  RETURN;

ELSIF duty_cycle = 42 THEN
  GET_ON_TIME := T#84ms;
  RETURN;

ELSIF duty_cycle = 43 THEN
  GET_ON_TIME := T#86ms;
  RETURN;

ELSIF duty_cycle = 44 THEN
  GET_ON_TIME := T#88ms;
  RETURN;

ELSIF duty_cycle = 45 THEN
  GET_ON_TIME := T#90ms;
  RETURN;

ELSIF duty_cycle = 46 THEN
  GET_ON_TIME := T#92ms;
  RETURN;

ELSIF duty_cycle = 47 THEN
  GET_ON_TIME := T#94ms;
  RETURN;

ELSIF duty_cycle = 48 THEN
  GET_ON_TIME := T#96ms;
  RETURN;

ELSIF duty_cycle = 49 THEN
  GET_ON_TIME := T#98ms;
  RETURN;

ELSIF duty_cycle = 50 THEN
  GET_ON_TIME := T#100ms;
  RETURN;

ELSIF duty_cycle = 51 THEN
  GET_ON_TIME := T#102ms;
  RETURN;

ELSIF duty_cycle = 52 THEN
  GET_ON_TIME := T#104ms;
  RETURN;

ELSIF duty_cycle = 53 THEN
  GET_ON_TIME := T#106ms;
  RETURN;

ELSIF duty_cycle = 54 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 55 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 56 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 57 THEN
  GET_ON_TIME := T#0ms;
  RETURN;
  
ELSIF duty_cycle = 58 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 59 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 60 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 61 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 62 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 63 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 64 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 65 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 66 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 67 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 68 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 69 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 70 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 71 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 72 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 73 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 74 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 75 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 76 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 77 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 78 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 79 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 80 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 81 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 82 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 83 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 84 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 85 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 86 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 87 THEN
  GET_ON_TIME := T#0ms;
  RETURN;
  
ELSIF duty_cycle = 88 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 89 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 90 THEN
  GET_ON_TIME := T#0ms;
  RETURN;
  
ELSIF duty_cycle = 91 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 92 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 93 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 94 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 95 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 96 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 97 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 98 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 99 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

ELSIF duty_cycle = 100 THEN
  GET_ON_TIME := T#0ms;
  RETURN;

END_IF;
]]></xhtml:p>
          </ST>
        </body>
      </pou>
    </pous>
  </types>
  <instances>
    <configurations>
      <configuration name="Config0">
        <resource name="Res0">
          <task name="task0" priority="0" interval="T#0.1ms">
            <pouInstance name="instance0" typeName="motor_driver"/>
          </task>
        </resource>
      </configuration>
    </configurations>
  </instances>
</project>
